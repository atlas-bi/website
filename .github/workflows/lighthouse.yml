name: ğŸ”¦ Lighthouse
on: [push]
jobs:
  lhci:
    runs-on: ubuntu-latest
    concurrency:
      group: ${{ github.workflow }}-${{ github.ref }}
      cancel-in-progress: true
    steps:
    - name: ğŸ’¾ Checkout
      uses: actions/checkout@v4
      with:
        ref: ${{ github.event.pull_request.head.sha }}

    - name: â” Setup node
      uses: actions/setup-node@v5
      with:
        node-version: 20

    - name: ğŸ“¥ Download deps
      uses: bahmutov/npm-install@3e063b974f0d209807684aa23e534b3dde517fd9
      with:
        useLockFile: false

    - name: ğŸ—ï¸ Build
      run: npm run build:ci

    - name: ğŸ”¦ Run Lighthouse
      run: |
        npm install -g @lhci/cli@0.9.x
        lhci autorun
      env:
        LHCI_GITHUB_APP_TOKEN: ${{ secrets.LHCI_GITHUB_APP_TOKEN }}
        LHCI_TOKEN: ${{ secrets.LHCI_TOKEN }}